<?xml version="1.0" standalone="no"?>

<kickstart>


	<description>
	Grid Data Farm 
	</description>

	<copyright>
	Copyright (c) 2000 - 2007 The Regents of the University of California.
	All rights reserved. Rocks(tm) v4.3 www.rocksclusters.org
	</copyright>

	<changelog>
	$Log$
	Revision 1.9.2.1  2007/09/19 10:14:28  nadya
	bring from 4.2.1
	
	Revision 1.9  2007/06/23 04:03:36  mjk
	mars hill copyright
	
	Revision 1.8  2006/09/11 22:48:38  mjk
	monkey face copyright
	
	Revision 1.7  2006/08/10 00:10:44  mjk
	4.2 copyright
	
	Revision 1.6  2005/10/12 18:09:29  mjk
	final copyright for 4.1
	
	Revision 1.5  2005/04/14 18:11:28  mjk
	*** empty log message ***
	
	Revision 1.4  2005/04/14 16:42:17  mjk
	*** empty log message ***
	
	Revision 1.3  2005/04/14 13:34:55  mjk
	AIST gets the copyright on this
	
	Revision 1.2  2005/04/14 13:18:53  mjk
	gfarm is an appliance type
	
	</changelog>

	<package>gfarm-fsnode</package>
	<package>gfarm-fsnode</package>
	<package>gfarm-devel</package>
	<package>gfarm-gfptool</package>
	<package>fuse-devel</package>

<post>

<file name="/etc/rc.d/rocksconfig.d/post-50-gfarm-data" perms="744">
#!/bin/sh

# check for compute nodes for a second interface.  When none exit.
addr=`cat /etc/sysconfig/network-scripts/ifcfg-eth1 | grep IPADDR| sed -e s/IPADDR=//`
if [ "$addr" == "" ]; then
   rpm -el gfarm-fsnode gfarm-devel gfarm-gfptool fuse-devel
   rm /etc/rc.d/rocksconfig.d/post-50-gfarm-data
   exit
fi

# add to iptables 
exists=`grep "Gfarm ports" /etc/sysconfig/iptables`
if [ "$exists"  == "" ]; then 
   if [ -f /tmp/iptables-add.py ]; then
      /tmp/iptables-add.py
      mv /tmp/iptables-add  /etc/sysconfig/iptables
   fi
fi

fsnode=`echo "select Value from app_globals where Component=\"GfarmFSNode\"" | mysql -u apache cluster | tail -1`

if [ "$fsnode" == "localhost" ]; then
   echo "update app_globals set Value='<var name="Kickstart_PublicHostname"/>' where Component='GfarmFSNode' and Value='localhost'" | mysql -u apache cluster
   config-gfsd /state/partition1/gfarm > /dev/null
fi


rm /etc/rc.d/rocksconfig.d/post-50-gfarm-data
</file>

</post>


</kickstart>
