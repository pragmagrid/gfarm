<?xml version="1.0" standalone="no"?>

<kickstart>


	<description>
	Grid Data Farm 
	</description>

	<copyright>
	Copyright (c) 2000 - 2007 The Regents of the University of California.
	All rights reserved. Rocks(tm) v4.3 www.rocksclusters.org
	</copyright>

	<changelog>
	$Log$
	Revision 1.12.2.2  2007/09/19 11:42:11  nadya
	rm old references to screens
	
	Revision 1.12.2.1  2007/09/19 10:14:28  nadya
	bring from 4.2.1
	
	Revision 1.12  2007/06/23 04:03:36  mjk
	mars hill copyright
	
	Revision 1.11  2006/09/11 22:48:38  mjk
	monkey face copyright
	
	Revision 1.10  2006/08/10 00:10:44  mjk
	4.2 copyright
	
	Revision 1.9  2005/10/12 18:09:29  mjk
	final copyright for 4.1
	
	Revision 1.8  2005/04/15 00:40:38  mjk
	- Changed name of gfarm nodes to gfarm-x-y
	- Gfarm Roll works for inside the cluster
	
	Revision 1.7  2005/04/14 22:56:32  mjk
	*** empty log message ***
	
	Revision 1.6  2005/04/14 18:24:01  mjk
	name like gfs-0-0
	
	Revision 1.5  2005/04/14 18:11:28  mjk
	*** empty log message ***
	
	Revision 1.4  2005/04/14 16:42:17  mjk
	*** empty log message ***
	
	Revision 1.3  2005/04/14 13:34:55  mjk
	AIST gets the copyright on this
	
	Revision 1.2  2005/04/14 13:18:53  mjk
	gfarm is an appliance type
	
	</changelog>

	<package>gfarm-server</package>
	<package>gfarm-doc</package>
	<package>gfarm-dbreport</package>
	<package>rocks-gfarm</package>

	<package>postgresql-server</package>
	<package>postgresql-contrib</package>

<post>


<file name="/etc/rc.d/rocksconfig.d/post-50-gfarm-server" perms="744">
#!/bin/sh

metaserver="<var name="Info_GfarmMetaserver"/>"

if [ "$metaserver" == "localhost" ]; then
   echo "update app_globals set Value='<var name="Kickstart_PublicHostname"/>' where Component='GfarmMetaserver'" | mysql -u apache cluster

   INTERACTIVE=false /sbin/runuser postgres -c '/bin/rm -f $HOME/.ssh/id_rsa.pub'
   INTERACTIVE=false /sbin/runuser postgres -c 'ssh-keygen -t rsa -N "" -f $HOME/.ssh/id_rsa.pub'

   if [ -f /etc/gfarm.conf ]; then
      mv /etc/gfarm.conf /etc/gfarm.conf.save
   fi

   config-gfarm  -b postgresql > /dev/null

   /opt/rocks/sbin/add-new-appliance --appliance-name gfarm \
                                     --xml-config-file-name gfarm-data \
                                     --short-name gf
else
   rpm -el gfarm-server
fi

rm /etc/rc.d/rocksconfig.d/post-50-gfarm-server
</file>

</post>

</kickstart>
